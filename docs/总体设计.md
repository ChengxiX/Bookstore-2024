# Bookstore 2024 总体设计文档
谢承熙
## 程序功能概述
本书店管理系统基于命令行交互，支持顾客、销售人员和店长三类用户的操作。系统以 C++ 实现，数据存储在外存中，支持嵌套登录和多账户操作。

主要功能包括：

顾客功能：注册、登录；查询图书（按 ISBN、书名、作者、关键字组合），购买图书。
销售人员功能：顾客所有操作，以及进货、录入/修改图书信息、创建用户。
店长功能：销售人员所有操作，以及查询采购记录、销售记录、盈利信息、员工操作日志及系统日志。
系统首次运行时需创建具有最高权限的店主账户，所有操作需实时读写文件，且运行中文件数为 15 个。

## 主体逻辑
初始化
读入指令，解析指令，验证合法性，处理逻辑，输出，循环读入

## 代码文件结构
main是读入、解析、验证一部分合法性后交由operations处理
operations验证合法性、处理逻辑、处理由数据库解析的数据
models定义operations操作，定义数据结构
randomdb负责实现类似于map的随机读写的块状链表。seqdb负责实现类似于数组的外存读写。
kvdb封装了randomdb并且提供了一个类似于set的读写接口。
MemoryRiver负责递增的读写，BlockRiver负责以块为单位的读写。
binable验证数据结构是否实现了二进制转换的接口。

## 功能设计
按照标准要求。
封装的块状给链表和其他数据接口都可以支持原生数据结构直接解释为二进制和自定义到二进制的转化两种模式，并且自动兼容自动转化。

## 数据模型和数据库
### 用户信息 2个文件
- 主键: UserID
- Password
- Username
- Privilege 
### 图书信息 9个文件
- 主键：图书id
- ISBN 号 索引
- 书名 索引
- 作者 索引
- 关键字 索引
- 库存
- 单价 定点两位，用long long表示
### 财务信息 1个文件
- 主键：订单id
- 采购还是销售
- 图书id 
- 价格 注意，如果是Import是总价，如果是Sale是单价
- 数量
- 额外信息
### 日志 3个文件
- 主键：id
- 操作类型
- 操作员id 索引
- 涉及记录id
- 其他信息 string

